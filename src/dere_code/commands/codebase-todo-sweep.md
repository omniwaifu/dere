---
description: Analyze codebase and insert TODO comments for code issues
allowed-tools: mcp__plugin_dere-code_serena__*, Read, Edit, Grep, Glob, Bash
argument-hint: [scan|apply|clean] [path]
---

# Codebase TODO Sweep

**Arguments:** `$1` = mode (scan|apply|clean), `$2` = path (optional)

## Mode: scan

1. Read `project_overview` memory for stack â†’ query Context7 for library best practices
2. Use `get_symbols_overview` + `find_symbol(include_body=true)` for analysis
3. Skip: node_modules/, .git/, __pycache__/, venv/, dist/, build/
4. Apply detection heuristics (see below)
5. Output report + save to `todo-sweep-[timestamp].md` memory

## Mode: apply

1. Run scan analysis
2. Insert comments using Edit tool (check for existing `(sweep)` to avoid duplicates):
   - `TODO(sweep):` - improvements
   - `FIXME(sweep):` - broken/critical
   - `HACK(sweep):` - code smells
   - `NOTE(sweep):` - missing docs
   - `TODO(sweep:stack): [Library] -` - framework-specific
   - `FIXME(sweep:stack):` - security issues
   - `PERF(sweep:stack):` - performance

## Mode: clean

1. Search pattern: `(TODO|FIXME|HACK|NOTE|PERF)\(sweep(:[a-z]+)?\)`
2. Remove matching comment lines with Edit

## Detection Heuristics

| Issue | Detection | Flag |
|-------|-----------|------|
| Long function | >50 non-empty lines | TODO: break into smaller functions |
| Missing docs | Public function, no docstring | NOTE: add docstring |
| Stub | Body is only `pass`/`...`/`return None` | FIXME: implement or remove |
| Bad naming | Single-letter var (except i,j,k,x,y) | TODO: rename |
| Deep nesting | >4 levels of if/for/while/try | HACK: reduce complexity |

## Stack-Specific Heuristics (if project_overview exists)

| Pattern | Detection | Flag |
|---------|-----------|------|
| React hooks | Missing deps in useEffect/useCallback | TODO(sweep:stack): React - |
| React keys | Missing key in .map() | TODO(sweep:stack): React - |
| Python async | blocking call in async def | FIXME(sweep:stack): Python - |
| TypeScript | missing return type, `any` usage | TODO(sweep:stack): TypeScript - |
| SQL injection | string concat in queries | FIXME(sweep:stack): [ORM] - |
| N+1 queries | ORM query inside loop | PERF(sweep:stack): [ORM] - |
| XSS | unescaped user input, dangerouslySetInnerHTML | FIXME(sweep:stack): - |
| Weak crypto | MD5/SHA1 for passwords | FIXME(sweep:stack): - |

## Usage

```
/codebase-todo-sweep scan           # report only
/codebase-todo-sweep apply src/     # insert TODOs in src/
/codebase-todo-sweep clean          # remove all sweep comments
```

## Notes

- Conservative: flag genuine issues only, skip minor style
- Skip autogenerated/vendored code
- Match file's comment style and indentation
- Query Context7 to verify best practices before flagging
